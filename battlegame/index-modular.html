<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>巴卡：全面战争（会战界面）- 模块化版本</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">巴卡：全面战争（会战界面）</h1>
            <h2>罗马 vs 迦太基 <span style="font-size: 0.6em; color: #95a5a6;">【模块化版本】</span></h2>
        </div>

        <div class="phase-bar">
            <div class="current-player-info">
                当前回合: <span id="current-player-text" class="rome">罗马</span>
            </div>
            <div class="phase-info">
                <span id="current-phase-text">阶段: 规划和移动</span>
            </div>
        </div>

        <div class="main-game-layout">
            <div class="game-board">
                <div class="square-grid-background"></div>
                <div id="square-grid" class="square-grid"></div>
            </div>

            <div class="game-info">
                <div id="phase-status-info" style="margin-bottom: 12px; padding: 12px; background: linear-gradient(135deg, rgba(52, 152, 219, 0.15), rgba(155, 89, 182, 0.15)); border-radius: 10px; border: 2px solid rgba(52, 152, 219, 0.4); text-align: center; font-weight: bold; font-size: 14px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    <div style="color: #3498db; margin-bottom: 5px; font-size: 13px;">当前回合</div>
                    <div id="sidebar-player-text" class="rome" style="font-size: 18px; margin-bottom: 10px; text-shadow: 0 0 10px rgba(231, 76, 60, 0.3);">🏛️ 罗马</div>
                    <div style="color: #3498db; margin-bottom: 5px; font-size: 13px;">当前阶段</div>
                    <div id="sidebar-phase-text" style="font-size: 16px; color: white; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">📦 部署阶段</div>
                </div>
                <div class="control-buttons">
                    <button id="add-step-btn" class="btn" style="display: none;">添加步骤</button>
                    <button id="finish-plan-btn" class="btn" style="display: none;">完成单位规划</button>
                    <button id="execute-plan-btn" class="btn" style="display: none;">执行移动</button>
                    <button id="cancel-move-btn" class="btn" style="display: none;">取消</button>
                    <button id="finish-all-plans-btn" class="btn" style="display: none;">完成所有规划</button>
                    <button id="execute-all-btn" class="btn" style="display: none;">统一执行</button>
                    <button id="finish-attacker-support-btn" class="btn" style="display: none;">完成攻击方支援选择</button>
                    <button id="finish-defender-support-btn" class="btn" style="display: none;">完成防守方支援选择</button>
                    <button id="defender-retreat-btn" class="btn" style="display: none; background: #e74c3c;">选择撤退</button>
                    <button id="defender-stand-btn" class="btn" style="display: none; background: #27ae60;">坚守战斗</button>
                    <button id="execute-charge-btn" class="btn" style="display: none;">执行冲锋</button>
                    <button id="confirm-ranged-attack-btn" class="btn" style="display: none; background: linear-gradient(135deg, #e67e22, #d35400);">🏹 确认射击</button>
                    <button id="next-phase-btn" class="btn">下一阶段</button>
                    <button id="confirm-deployment-btn" class="btn" style="display: none;">确认部署</button>
                    <button id="toggle-unit-info-btn" class="btn" style="background: linear-gradient(135deg, #16a085, #1abc9c);">👁️ 隐藏单位信息</button>
                    <button id="ai-toggle-btn" class="btn" style="background: linear-gradient(135deg, #27ae60, #229954);">🤖 启用迦太基AI</button>
                    <button id="ai-toggle-btn-rome" class="btn" style="background: linear-gradient(135deg, #c0392b, #e74c3c);">🤖 启用罗马AI</button>
                    <button id="save-game-btn" class="btn" style="background: linear-gradient(135deg, #27ae60, #229954);">💾 保存游戏</button>
                    <button id="load-game-btn" class="btn" style="background: linear-gradient(135deg, #8e44ad, #9b59b6);">📂 载入游戏</button>
                    <button id="reset-btn" class="btn">重新开始</button>
                </div>
                <div id="dice-result" style="display: none; text-align: center; margin-top: 10px; font-size: 16px; padding: 10px; background: #f8f9fa; border: 2px solid #3498db; border-radius: 8px; color: #2c3e50; font-weight: bold;"></div>
                
                <div class="game-log">
                    <h3 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 5px;">📜 游戏日志</h3>
                    <div id="game-log-content" style="height: 300px; overflow-y: auto; padding: 10px; background: #f8f9fa; border: 1px solid #bdc3c7; border-radius: 5px; font-size: 14px; line-height: 1.4; color: #2c3e50;">
                        <div style="color: #7f8c8d; font-style: italic;">游戏开始，等待行动...</div>
                    </div>
                </div>
                
                <div class="unit-info">
                    <div id="selected-unit-info">选择一个单位查看详情</div>
                    <div class="faction-stats">
                        <div class="faction-stat">
                            <span class="faction-label rome">🏛️ 罗马</span>
                            <span id="rome-count">6</span>
                        </div>
                        <div class="faction-stat">
                            <span class="faction-label carthage">🌊 迦太基</span>
                            <span id="carthage-count">6</span>
                        </div>
                    </div>
                </div>

                <div class="game-stats">
                    <div class="faction-stats rome">
                        <h3>罗马</h3>
                        <div id="rome-units">分值: <span id="rome-count-bottom">4</span></div>
                    </div>
                    <div class="faction-stats carthage">
                        <h3>迦太基</h3>
                        <div id="carthage-units">分值: <span id="carthage-count-bottom">4</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 游戏模式选择弹窗 -->
    <div id="game-mode-modal" class="game-mode-modal show">
        <div class="game-mode-modal-content">
            <div class="mode-header">
                <h1>⚔️ 巴卡：全面战争 ⚔️</h1>
                <p>选择战斗模式</p>
            </div>
            <div class="mode-buttons">
                <button id="default-battle-btn" class="mode-btn">
                    <div class="mode-icon">🎮</div>
                    <div class="mode-title">默认战斗</div>
                    <div class="mode-desc">使用预设兵力和部署开始战斗</div>
                </button>
                <button id="custom-battle-btn" class="mode-btn">
                    <div class="mode-icon">⚙️</div>
                    <div class="mode-title">自定义战斗</div>
                    <div class="mode-desc">自定义双方兵力和部署</div>
                </button>
            </div>
        </div>
    </div>

    <!-- 自定义战斗设置弹窗 -->
    <div id="custom-battle-modal" class="custom-battle-modal">
        <div class="custom-battle-modal-content">
            <h2>自定义战斗设置</h2>
            <div class="army-setup">
                <div class="faction-setup rome-setup">
                    <h3>🏛️ 罗马军团</h3>
                    <div class="input-group">
                        <label>步兵数量：</label>
                        <input type="number" id="rome-infantry" min="0" value="14000" step="100">
                        <span class="help-text">÷2000后四舍五入</span>
                    </div>
                    <div class="input-group">
                        <label>轻骑兵数量：</label>
                        <input type="number" id="rome-light-cavalry" min="0" value="0" step="50">
                        <span class="help-text">÷500后四舍五入</span>
                    </div>
                    <div class="input-group">
                        <label>重骑兵数量：</label>
                        <input type="number" id="rome-heavy-cavalry" min="0" value="1500" step="50">
                        <span class="help-text">÷500后四舍五入</span>
                    </div>
                    <div class="input-group">
                        <label>弓箭兵数量：</label>
                        <input type="number" id="rome-archers" min="0" value="4000" step="100">
                        <span class="help-text">÷1000后四舍五入</span>
                    </div>
                    <div class="input-group">
                        <label>将领领导值：</label>
                        <input type="number" id="rome-general-leadership" min="1" max="10" value="9">
                    </div>
                </div>
                <div class="faction-setup carthage-setup">
                    <h3>🌊 迦太基军团</h3>
                    <div class="input-group">
                        <label>步兵数量：</label>
                        <input type="number" id="carthage-infantry" min="0" value="16000" step="100">
                        <span class="help-text">÷2000后四舍五入</span>
                    </div>
                    <div class="input-group">
                        <label>轻骑兵数量：</label>
                        <input type="number" id="carthage-light-cavalry" min="0" value="0" step="50">
                        <span class="help-text">÷500后四舍五入</span>
                    </div>
                    <div class="input-group">
                        <label>重骑兵数量：</label>
                        <input type="number" id="carthage-heavy-cavalry" min="0" value="2000" step="50">
                        <span class="help-text">÷500后四舍五入（含1战象）</span>
                    </div>
                    <div class="input-group">
                        <label>弓箭兵数量：</label>
                        <input type="number" id="carthage-archers" min="0" value="3000" step="100">
                        <span class="help-text">÷1000后四舍五入</span>
                    </div>
                    <div class="input-group">
                        <label>将领领导值：</label>
                        <input type="number" id="carthage-general-leadership" min="1" max="10" value="9">
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="start-custom-battle-btn" class="mode-btn primary">开始战斗</button>
                <button id="cancel-custom-battle-btn" class="mode-btn secondary">返回</button>
            </div>
        </div>
    </div>

    <!-- 胜负结算弹窗 -->
    <div id="victory-modal" class="victory-modal">
        <div class="victory-modal-content">
            <div class="victory-banner">
                <div id="victory-icon" class="victory-icon"></div>
                <h1 id="victory-title" class="victory-title"></h1>
            </div>
            <div class="victory-details">
                <h2>战斗结算</h2>
                <div class="faction-result">
                    <div class="result-row rome-result">
                        <span class="faction-name">🏛️ 罗马</span>
                        <span id="rome-final-score" class="faction-score"></span>
                    </div>
                    <div class="result-row carthage-result">
                        <span class="faction-name">🌊 迦太基</span>
                        <span id="carthage-final-score" class="faction-score"></span>
                    </div>
                </div>
                <div id="victory-message" class="victory-message"></div>
            </div>
            <button id="victory-restart-btn" class="victory-btn">重新开始</button>
        </div>
    </div>

    <!-- 模块化加载方式 -->
    <!-- 1. 先加载核心游戏代码（包含 HexGame 类） -->
    <script src="js/game-core.js"></script>
    
    <!-- 2. 加载自定义单位生成逻辑 -->
    <script src="js/custom-units.js"></script>
    
    <!-- 3. 加载战斗桥接模块 -->
    <script src="js/battle-bridge.js"></script>
    
    <!-- 4. 加载战棋AI控制器 -->
    <script src="js/battle-ai-controller.js"></script>
    <script src="js/battle-ai-controller-rome.js"></script>
    
    <!-- 5. 再加载主入口（初始化游戏） -->
    <script src="js/game-main.js"></script>
</body>
</html> 