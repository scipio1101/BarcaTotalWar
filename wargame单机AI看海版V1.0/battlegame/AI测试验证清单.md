# 战棋AI测试验证清单

## ✅ 快速验证步骤

### 1️⃣ 启动游戏
- [ ] 打开浏览器，访问 `battlegame/index-modular.html`
- [ ] 看到游戏模式选择弹窗
- [ ] 选择"默认战斗"模式

### 2️⃣ 罗马方部署
- [ ] 拖拽罗马单位到下方区域
- [ ] 点击"确认部署"按钮
- [ ] 看到"罗马部署完成，轮到迦太基部署"提示

### 3️⃣ 启用AI
- [ ] 点击右侧的 **"🤖 启用迦太基AI"** 按钮
- [ ] 按钮变为红色（表示已启用）
- [ ] 控制台显示 "✅ 迦太基AI已启用"

### 4️⃣ 部署阶段测试
观察AI自动部署：
- [ ] AI自动部署将领到中后方
- [ ] AI自动部署战象到前排
- [ ] AI自动部署骑兵到两翼
- [ ] AI自动部署步兵到前排
- [ ] AI自动部署弓箭手到后排
- [ ] AI点击"确认部署"按钮
- [ ] 游戏进入移动阶段（罗马回合）

### 5️⃣ 移动阶段测试（关键！）
罗马回合结束后，观察迦太基AI：

**规划阶段**：
- [ ] 控制台显示 "🚶 开始规划移动..."
- [ ] AI依次选择每个单位
- [ ] 每个单位显示移动计划的线条
- [ ] 控制台显示每个单位的规划信息

**执行阶段**：
- [ ] 控制台显示 "✓ 完成所有单位规划"
- [ ] 控制台显示 "✓ 开始统一执行移动"
- [ ] 控制台显示 "└─ 等待移动执行完成 (XXXXms)"
- [ ] **重要**：看到单位实际移动（有移动动画）
- [ ] 所有单位都移动到了新位置
- [ ] 控制台显示 "✓ 移动执行完成，进入下一阶段"
- [ ] 游戏进入转向阶段

### 6️⃣ 转向阶段测试
- [ ] 控制台显示 "🔄 开始调整朝向..."
- [ ] AI调整单位朝向面对敌人
- [ ] 控制台显示 "✓ 转向调整完成"
- [ ] 游戏进入远程阶段

### 7️⃣ 远程阶段测试
- [ ] 控制台显示 "🏹 开始远程攻击..."
- [ ] AI的弓箭手选择目标
- [ ] 看到射击动画/效果
- [ ] 敌方单位HP减少
- [ ] 控制台显示 "✓ 远程攻击完成"
- [ ] 游戏进入近战阶段

### 8️⃣ 近战阶段测试
- [ ] 控制台显示 "⚔️ 开始近战..."
- [ ] AI选择冲锋单位（骑兵/战象）
- [ ] AI选择攻击目标
- [ ] AI选择支援单位
- [ ] 看到近战战斗结算
- [ ] 单位HP变化

### 9️⃣ 回合循环
- [ ] AI完成所有阶段后，轮到罗马回合
- [ ] 可以持续观察多个回合
- [ ] AI每个回合都正常运作

## 🔍 重点检查项（移动阶段）

移动阶段是本次修复的重点，请特别注意：

### ✅ 成功标志
1. **规划成功**
   - 在游戏板上看到移动计划的线条/标记
   - 控制台显示每个单位的规划信息

2. **执行成功**（最重要！）
   - 点击"统一执行"按钮后
   - 单位**实际移动**了（不是停在原地）
   - 看到移动动画
   - 单位坐标发生变化

3. **阶段转换成功**
   - 移动执行完成后才进入转向阶段
   - 不是规划完就跳到转向阶段

### ❌ 失败标志（需要报告）
1. **规划后不执行**
   - 规划完成但单位没有移动
   - 直接跳到转向阶段

2. **执行不完整**
   - 只有部分单位移动
   - 移动动画中断

3. **等待时间不足**
   - 移动还在执行就进入下一阶段
   - 单位移动到一半被打断

## 🐛 常见问题排查

### 问题1: AI不启动
**现象**：点击启用按钮后AI没反应

**检查**：
```javascript
// 在控制台运行
console.log('AI启用:', window.battleAI.enabled)
console.log('当前玩家:', window.game.currentPlayer)
console.log('当前阶段:', window.game.currentPhase)
```

**解决**：
- 确认按钮变红
- 确认轮到迦太基回合
- 尝试手动触发：`window.triggerBattleAI()`

### 问题2: 移动不执行
**现象**：规划完成但单位不移动

**检查**：
```javascript
// 在控制台运行
console.log('移动计划数量:', window.game.allUnitPlans.size)
console.log('移动状态:', window.game.moveState)
console.log('执行按钮:', document.getElementById('execute-all-btn'))
```

**解决**：
- 查看控制台错误信息
- 确认"统一执行"按钮存在且可见
- 检查是否有JavaScript错误

### 问题3: 移动太快看不清
**现象**：AI操作太快

**解决**：
```javascript
// 在控制台减慢AI速度
window.battleAI.autoDelay = 2000  // 改为2秒
```

### 问题4: 单位卡住不动
**现象**：某些单位规划后一直不移动

**检查**：
```javascript
// 查看具体单位信息
window.game.units.filter(u => u.faction === 'carthage').forEach(u => {
    console.log(u.name, '位置:', u.x, u.y, 'HP:', u.hp)
})
```

## 📊 控制台日志示例

### 正常的移动阶段日志应该是这样的：

```
[战棋AI] 🤖 AI开始思考 - 阶段: movement
[战棋AI] 🚶 开始规划移动...
[战棋AI] └─ 迦太基骑兵1 规划移动: (20,41) → (25,36)
[战棋AI]   └─ 已完成 迦太基骑兵1 的移动规划
[战棋AI] └─ 迦太基步兵1 规划移动: (35,40) → (40,35)
[战棋AI]   └─ 已完成 迦太基步兵1 的移动规划
[战棋AI] └─ 迦太基弓手1 规划移动: (30,44) → (35,39)
[战棋AI]   └─ 已完成 迦太基弓手1 的移动规划
[战棋AI] ✓ 完成所有单位规划
[战棋AI] ✓ 开始统一执行移动
[战棋AI] └─ 等待移动执行完成 (4800ms)
[游戏日志] 🎲 开始逐个执行6个单位的移动计划（包含移动动画）
[游戏日志] 迦太基骑兵1 移动到 (25, 36)
[游戏日志] 迦太基步兵1 移动到 (40, 35)
...
[战棋AI] ✓ 移动执行完成，进入下一阶段
[战棋AI] ✓ 进入下一阶段
```

## 🎓 调试技巧

### 开启详细日志
```javascript
window.battleAI.debugMode = true
```

### 单步执行（手动模式）
```javascript
// 禁用自动模式
window.battleAI.disable()

// 手动触发每个阶段
window.triggerBattleAI()  // 执行当前阶段
window.game.nextPhase()   // 进入下一阶段
```

### 查看游戏状态
```javascript
window.checkGameState()
```

### 检查按钮状态
```javascript
console.log('完成所有规划按钮:', 
    document.getElementById('finish-all-plans-btn')?.style.display)
console.log('统一执行按钮:', 
    document.getElementById('execute-all-btn')?.style.display)
```

## ✅ 测试完成标准

所有以下条件都满足时，说明AI工作正常：

- [x] 部署阶段：AI成功部署所有单位
- [x] 移动阶段：AI规划并**实际执行**移动
- [x] 转向阶段：AI调整单位朝向
- [x] 远程阶段：AI的弓箭手成功射击
- [x] 近战阶段：AI发起冲锋并选择支援
- [x] 无JavaScript错误
- [x] 游戏流程顺畅
- [x] 所有阶段按顺序执行

## 📝 测试报告

如果发现问题，请提供以下信息：

1. **问题现象**：详细描述发生了什么
2. **出现阶段**：在哪个阶段出现问题
3. **控制台日志**：复制相关的日志输出
4. **浏览器信息**：浏览器类型和版本
5. **复现步骤**：如何重现该问题

---

**测试日期**：____________  
**测试人员**：____________  
**测试结果**：[ ] 通过  [ ] 失败  
**问题记录**：____________

